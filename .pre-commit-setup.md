# Pre-commit Hooks Setup

This repository uses [pre-commit](https://pre-commit.com/) to ensure code quality before commits.

## What Pre-commit Does

Pre-commit automatically runs checks on your code before allowing a commit. This includes:

### General Checks
- ✅ Trim trailing whitespace
- ✅ Ensure files end with a newline
- ✅ Validate YAML files
- ✅ Validate JSON files
- ✅ Check for large files (>500KB)
- ✅ Detect merge conflicts
- ✅ Detect private keys
- ✅ Prevent commits directly to main/master branches

### Backend (Python)
- ✅ **Ruff linting** - Auto-fix common issues
- ✅ **Ruff formatting** - Format code to standards

### Frontend (TypeScript/React)
- ✅ **ESLint** - Check JavaScript/TypeScript code quality
- ✅ **TypeScript type checking** - Ensure type safety

## Installation

### First-time Setup

1. **Install backend dependencies** (includes pre-commit):
   ```bash
   cd backend
   uv sync
   ```

2. **Install the git hooks**:
   ```bash
   # From the project root
   backend/.venv/bin/pre-commit install
   ```

3. **Test the hooks** (optional):
   ```bash
   backend/.venv/bin/pre-commit run --all-files
   ```

## Usage

Once installed, pre-commit runs automatically when you try to commit:

```bash
git add .
git commit -m "Your commit message"
# Pre-commit hooks will run automatically
```

### If Hooks Fail

If a hook fails:
1. Review the errors in the terminal
2. Many hooks auto-fix issues (e.g., trailing whitespace, formatting)
3. For auto-fixed files, simply stage them again:
   ```bash
   git add .
   git commit -m "Your commit message"
   ```
4. For issues that can't be auto-fixed (e.g., ESLint errors), fix them manually

### Skip Hooks (Use Sparingly)

Only in emergencies, you can skip hooks with:
```bash
git commit --no-verify -m "Emergency commit"
```

**⚠️ This is strongly discouraged** as it bypasses quality checks.

## Manual Hook Execution

Run all hooks manually:
```bash
backend/.venv/bin/pre-commit run --all-files
```

Run a specific hook:
```bash
backend/.venv/bin/pre-commit run ruff --all-files
backend/.venv/bin/pre-commit run eslint --all-files
```

## Updating Hooks

Update to the latest hook versions:
```bash
backend/.venv/bin/pre-commit autoupdate
```

## CI/CD Integration

Pre-commit hooks are also run in the GitHub Actions CI pipeline to ensure quality on all branches.

## Configuration

The pre-commit configuration is in `.pre-commit-config.yaml` at the project root.

## Troubleshooting

### "pre-commit: command not found"
Make sure you run pre-commit from the backend virtual environment:
```bash
backend/.venv/bin/pre-commit install
```

### Frontend hooks failing
Ensure frontend dependencies are installed:
```bash
cd frontend
npm install
```

### Hook takes too long
Some hooks (especially TypeScript checking) can be slow on the first run. Subsequent runs are cached and faster.
